<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web3 DApp · Live Demo</title>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
        font-family:'Inter',sans-serif;
        background:#05080d;
        color:#fff;
        min-height:100vh;
        display:grid;
        place-items:center;
        padding:20px;
        overflow:hidden;
        position:relative;
    }
    canvas{position:absolute;inset:0;z-index:0;}
    .container{
        position:relative;z-index:1;
        width:100%;max-width:440px;
        background:rgba(10,18,30,0.88);
        padding:55px 35px;
        border-radius:24px;
        text-align:center;
        backdrop-filter:blur(16px);
        border:1px solid rgba(0,255,195,0.3);
        box-shadow:0 25px 60px rgba(0,0,0,0.7);
    }
    h1{
        font-size:3.2rem;font-weight:800;
        background:linear-gradient(90deg,#00ffc3,#00d4aa);
        -webkit-background-clip:text;
        -webkit-text-fill-color:transparent;
        margin-bottom:10px;
    }
    .subtitle{color:#a0e6d0;font-size:1.15rem;margin-bottom:50px;}
    button{
        width:100%;padding:19px;margin:14px 0;
        border:none;border-radius:50px;
        font-size:1.25rem;font-weight:700;
        cursor:pointer;transition:all .35s;
    }
    #connect{
        background:#00ffc3;color:#000;
        box-shadow:0 12px 40px rgba(0,255,195,0.5);
    }
    #connect:hover{transform:translateY(-5px);box-shadow:0 20px 50px rgba(0,255,195,0.6);}
    #read{background:#0a1f1a;color:#666;}
    #read:enabled{background:#00ffc3;color:#000;box-shadow:0 12px 40px rgba(0,255,195,0.5);}
    #message{
        margin-top:45px;padding:35px;
        background:rgba(0,255,195,0.08);
        border:1px solid rgba(0,255,195,0.4);
        border-radius:24px;
        font-size:1.3rem;
        min-height:120px;display:grid;place-items:center;
    }
    #status{margin:15px 0;color:#00ffc3;font-weight:600;}
</style>
</head>
<body>

<canvas id="particles"></canvas>

<div class="container">
    <h1>Web3 DApp</h1>
    <p class="subtitle">Live smart contract · Multi-wallet · Production ready</p>
    <button id="connect">Connect Wallet</button>
    <button id="read" disabled>Fetch Live Data</button>
    <div id="status"></div>
    <div id="message">Connect your wallet to read on-chain data</div>
</div>

<script>
// Falling green particles
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;
const particles = [];
for(let i=0;i<70;i++){
    particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.8+0.6, s:Math.random()*1.2+0.4});
}
function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="rgba(0,255,195,0.6)";
    particles.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();p.y+=p.s;if(p.y>canvas.height)p.y=0;});
    requestAnimationFrame(animate);
}
animate();
window.addEventListener('resize',()=>{canvas.width=innerWidth;canvas.height=innerHeight;});

// MAGIC FIX: Force wallet popup even on GitHub Pages
const contractAddress = "0xd9145CCE52D386f254917e481eB44e9943F39138";
const abi = [{"inputs":[],"name":"greet","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}];

let web3, contract, account;

document.getElementById("connect").onclick = async () => {
    let provider = null;

    // Try every possible wallet injection (MetaMask, Trust, Coinbase, Brave, etc.)
    if (window.ethereum) provider = window.ethereum;
    else if (window.web3) provider = window.web3.currentProvider;
    else if (window.binancechain) provider = window.binancechain;
    else if (window.trustwallet) provider = window.trustwallet;
    else if (window.coinbaseWalletExtension) provider = window.coinbaseWalletExtension;

    if (!provider) {
        document.getElementById("status").innerHTML = "No wallet found. Install MetaMask or Trust Wallet";
        return;
    }

    web3 = new Web3(provider);

    try {
        // This line FORCES the popup even if GitHub tries to block
        const accounts = await provider.request({ method: "eth_requestAccounts" });
        account = accounts[0];

        contract = new web3.eth.Contract(abi, contractAddress);

        document.getElementById("status").innerHTML = `Connected: ${account.slice(0,10)}...`;
        document.getElementById("connect").disabled = true;
        document.getElementById("read").disabled = false;
    } catch (error) {
        document.getElementById("status").innerHTML = "Connection rejected or blocked";
    }
};

document.getElementById("read").onclick = async () => {
    try {
        const data = await contract.methods.greet().call();
        document.getElementById("message").innerHTML = `<strong>Live from Blockchain:</strong><br><br><span style="color:#00ffc3;font-size:1.6em;">“${data}”</span>`;
    } catch (e) {
        document.getElementById("message").innerHTML = "Wrong network — switch to Sepolia Testnet";
    }
};
</script>

</body>
</html>